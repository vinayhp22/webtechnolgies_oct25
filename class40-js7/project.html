<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD App(HTML + Bootstrap + JS)</title>
    <link rel="stylesheet" href="bootstrap-5.3.8-dist/css/bootstrap.min.css">
<style>
    .error {
        color: red;
        font-size: 1em;
    }
</style>
</head>
<body class="p-4">
    <div class="container">
        <h2 class="mb-4 text-center">Simple CRUD App</h2>

        <form id="userForm" class="row g-3 mb-4">
            <input type="hidden" id="userid">

            <div class="col-md-4">
                <input type="text" class="form-control" id="name" placeholder="Enter the Name">
                <div id="nameError" class="error"></div>
            </div>
            <div class="col-md-4">
                <input type="email" class="form-control" id="email" placeholder="Enter the Email">
                <div id="emailError" class="error"></div>
            </div>
            <div class="col-md-4 d-grid">
                <button type="submit" class="btn btn-primary" id="saveAndUpdateBtn">Save</button>
            </div>
        </form>

        <!-- Data Table -->
         <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="userTableBody"></tbody>
         </table>
    </div>
    

    <script>
        let students = JSON.parse(localStorage.getItem('students')) || []; //

        let userForm = document.getElementById("userForm");
        let userIdInput = document.getElementById("userid");
        let userNameInput = document.getElementById("name");
        let userEmailInput = document.getElementById("email");
        let userTableBody = document.getElementById("userTableBody");

        let nameError = document.getElementById("nameError");
        let emailError = document.getElementById("emailError");

        let saveAndUpdateBtn = document.getElementById("saveAndUpdateBtn");

        // Add User 
        userForm.addEventListener("submit", function(e){
            e.preventDefault();
            const name = userNameInput.value.trim();
            const email = userEmailInput.value.trim();
            const userid = userIdInput.value;

            if(!validateForm(name, email)){
                return; //Stop if validation fails
            }

            if(userid === ''){
                //Create New User
                students.push({name, email});
                alert("Successfully saved!!!")
            } else {
                //Update the current user
                students[userid] = {name, email};
                userIdInput.value = "";
                saveAndUpdateBtn.textContent = "Save";
                alert("Successfully updated!!!")
            }
            localStorage.setItem('students', JSON.stringify(students));
            userForm.reset();
            renderTable();
        })

        //Validate User
        function validateForm(name, email){
            let isValid = true;

            nameError.textContent = '';
            emailError.textContent = '';

            //Name Validations: alphabets + space only
            const nameRegex = /^[A-Za-z ]+$/;
            if(!nameRegex.test(name)){
                nameError.textContent = "Name should contains only letters & spaces.";
                isValid = false;
            }

            // Email Validation: 
            const emailRegex = /^[a-zA-Z0-9._]+@[a-zA-Z0-9.-]+\.[a-z]{2,}$/;
            if(!emailRegex.test(email)){
                emailError.textContent = "Please enter a valid email address.";
                isValid = false;
            }
            return isValid;
        }

        //Show Data(Read Operation)
        function renderTable(){
            userTableBody.innerHTML = '';
            students.forEach((student, index) => {
                userTableBody.innerHTML += `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.email}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onClick="editUser(${index})">Edit</button>
                            <button class="btn btn-sm btn-danger" onClick="deleteUser(${index})">Delete</button>    
                        </td>
                    </tr>
                `;
            });
        }

        //Edit User(Update Operation)
        function editUser(index){
            const student = students[index];
            userIdInput.value = index;
            userNameInput.value = student.name;
            userEmailInput.value = student.email;
            saveAndUpdateBtn.textContent = "Update";
        }

        //Delete User(Delete Ops)
        function deleteUser(index){
            if(confirm("Are you sure you want to delete this user?")){
                students.splice(index,1);
                localStorage.setItem("students", JSON.stringify(students));
                renderTable();
                alert("Successfully deleted!!!")
            }
        }
        renderTable();
    </script>
</body>
</html>